import{r as l,j as e,T,a as S,c as M,B as u,d as R,e as L,u as P,L as F}from"./index-fQZ-U2x6.js";import{u as j}from"./useQuery-BewFOG_L.js";import{u as o}from"./useMutation-BOTsmzZA.js";import{s as g}from"./services--_aFGxDX.js";import{A as H,a as b}from"./AlertItem-xaGF1g_8.js";import{M as c,T as E}from"./types-wJsVDGZp.js";import{S as U}from"./StateIndicator-CC9lMCtR.js";import{L as q}from"./label-B2sNe2d1.js";import{M as A}from"./MonitorDescription-BD236ExW.js";import{C as v,a as y,b as f,c as k}from"./card-BmoCGL6B.js";import{S as d}from"./skeleton-C53g7VWF.js";import"./badge-BqSicr3y.js";import"./formatDistanceToNow-BIWrupWh.js";function V({title:a,titleId:t,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),a?l.createElement("title",{id:t},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const D=l.forwardRef(V);function K({title:a,titleId:t,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),a?l.createElement("title",{id:t},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"}))}const O=l.forwardRef(K);function x({label:a,url:t}){const[r,n]=l.useState(!1),h=async()=>{await navigator.clipboard.writeText(t),n(!0),setTimeout(()=>n(!1),2e3)};return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(q,{className:"text-foreground",children:a}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-muted px-3 py-2 rounded text-sm font-mono truncate",children:t}),e.jsx(T,{children:e.jsxs(S,{children:[e.jsx(M,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"icon",onClick:h,children:r?e.jsx(D,{className:"h-5 w-5 text-green-500"}):e.jsx(O,{className:"h-5 w-5"})})}),e.jsx(R,{children:e.jsx("p",{children:r?"Copied!":"Copy to clipboard"})})]})})]})]})}function se(){const{serviceId:a}=L({strict:!1}),t=P(),{data:r,isLoading:n}=j({queryKey:["services",a],queryFn:()=>g.get(a)}),{data:h}=j({queryKey:["alerts","service",a],queryFn:()=>b.list(1,10)}),w=o({mutationFn:()=>g.pause(a),onSuccess:()=>t.invalidateQueries({queryKey:["services"]})}),N=o({mutationFn:()=>g.resume(a),onSuccess:()=>t.invalidateQueries({queryKey:["services"]})}),C=o({mutationFn:s=>b.acknowledge(s),onSuccess:()=>t.invalidateQueries({queryKey:["alerts"]})}),m=o({mutationFn:s=>fetch(s,{method:"POST"}).then(i=>{if(!i.ok)throw new Error(`HTTP ${i.status}`);return i.json()}),onSuccess:()=>t.invalidateQueries({queryKey:["services"]})}),p=o({mutationFn:s=>fetch(s,{method:"POST"}).then(i=>{if(!i.ok)throw new Error(`HTTP ${i.status}`);return i.json()}),onSuccess:()=>t.invalidateQueries({queryKey:["services"]})});return n||!r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"h-8 w-48"}),e.jsx(d,{className:"h-4 w-64"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{className:"h-8 w-16 rounded-full"}),e.jsx(d,{className:"h-9 w-20 rounded-md"}),e.jsx(d,{className:"h-9 w-16 rounded-md"})]})]}),e.jsx(d,{className:"h-48 w-full rounded-lg"}),e.jsx(d,{className:"h-36 w-full rounded-lg"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:r.name}),r.description&&e.jsx("p",{className:"text-muted-foreground mt-1",children:r.description})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(U,{state:r.state,size:"lg"}),e.jsxs("div",{className:"flex gap-2",children:[r.state!==3?e.jsx(u,{variant:"outline",className:"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 hover:bg-yellow-200 dark:hover:bg-yellow-800 border-yellow-200 dark:border-yellow-700",onClick:()=>w.mutate(),children:"Pause"}):e.jsx(u,{variant:"outline",className:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 hover:bg-green-200 dark:hover:bg-green-800 border-green-200 dark:border-green-700",onClick:()=>N.mutate(),children:"Resume"}),e.jsx(F,{to:"/services/$serviceId/edit",params:{serviceId:a},className:"px-4 py-2 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded hover:bg-blue-200 dark:hover:bg-blue-800",children:"Edit"})]})]})]}),e.jsxs(v,{className:"py-0",children:[e.jsx(y,{children:e.jsx(f,{className:"text-lg",children:"Monitors"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-6",children:r.monitors.map(s=>e.jsxs("div",{className:"border-b pb-4 last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"font-medium",children:[s.type===c.Webhook&&"Webhook",s.type===c.Heartbeat&&"Heartbeat",s.type===c.HealthCheck&&"Health Check",s.type===c.Metric&&"Metric"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",s.intervalSeconds,"s interval)"]})]}),e.jsx(A,{type:s.type,variant:"full"}),s.type===c.Webhook&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(x,{label:"Failure URL (HTTP POST)",url:s.webhookFailUrl}),e.jsx(x,{label:"Recovery URL (HTTP POST)",url:s.webhookRecoverUrl}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(u,{variant:"destructive",size:"sm",onClick:()=>m.mutate(s.webhookFailUrl),disabled:m.isPending,children:m.isPending?"Sending...":"Test Fail"}),e.jsx(u,{variant:"outline",size:"sm",className:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 hover:bg-green-200 dark:hover:bg-green-800 border-green-200 dark:border-green-700",onClick:()=>p.mutate(s.webhookRecoverUrl),disabled:p.isPending,children:p.isPending?"Sending...":"Test Recover"})]})]}),s.type===c.Heartbeat&&e.jsx(x,{label:"Heartbeat URL",url:s.heartbeatUrl}),s.type===c.Metric&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(x,{label:"Metric Push URL (POST with value)",url:s.metricUrl}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-muted-foreground mt-2",children:[s.minValue!=null&&e.jsxs("span",{children:["Min: ",s.minValue]}),s.maxValue!=null&&e.jsxs("span",{children:["Max: ",s.maxValue]}),s.thresholdStrategy!=null&&e.jsxs("span",{children:["Strategy: ",E[s.thresholdStrategy]]}),s.thresholdCount!=null&&e.jsxs("span",{children:["Count: ",s.thresholdCount]}),s.retentionDays!=null&&e.jsxs("span",{children:["Retention: ",s.retentionDays,"d"]})]}),s.lastMetricValue!=null&&s.lastMetricAt&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Latest: ",s.lastMetricValue," at ",new Date(s.lastMetricAt).toLocaleString()]})]}),s.type===c.HealthCheck&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["URL: ",s.healthCheckUrl]}),e.jsxs("span",{children:["Method: ",s.httpMethod??"GET"]}),e.jsxs("span",{children:["Expected: ",s.expectedStatusCodes??"200"]}),e.jsxs("span",{children:["Timeout: ",s.timeoutSeconds??10,"s"]}),s.bodyMatchRegex&&e.jsxs("span",{className:"col-span-2",children:["Body match: ",e.jsx("code",{className:"bg-muted px-1 rounded",children:s.bodyMatchRegex})]})]})}),s.lastCheckIn&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Last check-in: ",new Date(s.lastCheckIn).toLocaleString()]})]},s.id))})})]}),e.jsxs(v,{className:"py-0",children:[e.jsx(y,{children:e.jsx(f,{className:"text-lg",children:"Recent Alerts"})}),e.jsx(k,{children:h?.items.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No alerts for this service"}):e.jsx("div",{className:"space-y-3",children:h?.items.map(s=>e.jsx(H,{alert:s,onAcknowledge:()=>C.mutate(s.id)},s.id))})})]})]})}export{se as ServiceDetail};
