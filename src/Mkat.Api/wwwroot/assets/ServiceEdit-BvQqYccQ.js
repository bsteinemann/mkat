import{r as s,j as t,g as we,P as Ee,h as Re,i as te,k as ee,l as Pe,m as De,n as Te,e as Ae,f as Ie,u as se,B as E,t as j}from"./index-fQZ-U2x6.js";import{u as Z}from"./useQuery-BewFOG_L.js";import{u as V}from"./useMutation-BOTsmzZA.js";import{g as F,M as b,T as w}from"./types-wJsVDGZp.js";import{s as I,c as X}from"./services--_aFGxDX.js";import{S as Ve,M as Fe,I as ae,a as ne,H as re}from"./ServiceForm-B7AGGh7L.js";import{u as He,C as _e}from"./select-kY1Lm6qJ.js";import{L as oe}from"./label-B2sNe2d1.js";import{C as z,c as K,a as ce,b as ie}from"./card-BmoCGL6B.js";import{S as H}from"./skeleton-C53g7VWF.js";import{A as le,a as de,b as ue,c as he,d as xe,e as pe,f as me,g as fe,h as ve}from"./alert-dialog-uLfenLJA.js";import"./MonitorDescription-BD236ExW.js";import"./input-BJMnUOvO.js";import"./textarea-Bhhfjl39.js";import"./index-DPAcrdZo.js";function qe(e){const r=Ue(e),o=s.forwardRef((i,c)=>{const{children:n,...d}=i,l=s.Children.toArray(n),u=l.find(Be);if(u){const x=u.props.children,v=l.map(a=>a===u?s.Children.count(x)>1?s.Children.only(null):s.isValidElement(x)?x.props.children:null:a);return t.jsx(r,{...d,ref:c,children:s.isValidElement(x)?s.cloneElement(x,void 0,v):null})}return t.jsx(r,{...d,ref:c,children:n})});return o.displayName=`${e}.Slot`,o}function Ue(e){const r=s.forwardRef((o,i)=>{const{children:c,...n}=o;if(s.isValidElement(c)){const d=ze(c),l=Ge(n,c.props);return c.type!==s.Fragment&&(l.ref=i?we(i,d):d),s.cloneElement(c,l)}return s.Children.count(c)>1?s.Children.only(null):null});return r.displayName=`${e}.SlotClone`,r}var Le=Symbol("radix.slottable");function Be(e){return s.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Le}function Ge(e,r){const o={...r};for(const i in r){const c=e[i],n=r[i];/^on[A-Z]/.test(i)?c&&n?o[i]=(...l)=>{const u=n(...l);return c(...l),u}:c&&(o[i]=c):i==="style"?o[i]={...c,...n}:i==="className"&&(o[i]=[c,n].filter(Boolean).join(" "))}return{...e,...o}}function ze(e){let r=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,o=r&&"isReactWarning"in r&&r.isReactWarning;return o?e.ref:(r=Object.getOwnPropertyDescriptor(e,"ref")?.get,o=r&&"isReactWarning"in r&&r.isReactWarning,o?e.props.ref:e.props.ref||e.ref)}var Ke=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],J=Ke.reduce((e,r)=>{const o=qe(`Primitive.${r}`),i=s.forwardRef((c,n)=>{const{asChild:d,...l}=c,u=d?o:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),t.jsx(u,{...l,ref:n})});return i.displayName=`Primitive.${r}`,{...e,[r]:i}},{}),W="Checkbox",[$e]=De(W),[Oe,Y]=$e(W);function Qe(e){const{__scopeCheckbox:r,checked:o,children:i,defaultChecked:c,disabled:n,form:d,name:l,onCheckedChange:u,required:x,value:v="on",internal_do_not_use_render:a}=e,[m,h]=Re({prop:o,defaultProp:c??!1,onChange:u,caller:W}),[g,y]=s.useState(null),[k,f]=s.useState(null),C=s.useRef(!1),N=g?!!d||!!g.closest("form"):!0,M={checked:m,disabled:n,setChecked:h,control:g,setControl:y,name:l,form:d,value:v,hasConsumerStoppedPropagationRef:C,required:x,defaultChecked:P(c)?!1:c,isFormControl:N,bubbleInput:k,setBubbleInput:f};return t.jsx(Oe,{scope:r,...M,children:We(a)?a(M):i})}var Ce="CheckboxTrigger",ge=s.forwardRef(({__scopeCheckbox:e,onKeyDown:r,onClick:o,...i},c)=>{const{control:n,value:d,disabled:l,checked:u,required:x,setControl:v,setChecked:a,hasConsumerStoppedPropagationRef:m,isFormControl:h,bubbleInput:g}=Y(Ce,e),y=te(c,v),k=s.useRef(u);return s.useEffect(()=>{const f=n?.form;if(f){const C=()=>a(k.current);return f.addEventListener("reset",C),()=>f.removeEventListener("reset",C)}},[n,a]),t.jsx(J.button,{type:"button",role:"checkbox","aria-checked":P(u)?"mixed":u,"aria-required":x,"data-state":Ne(u),"data-disabled":l?"":void 0,disabled:l,value:d,...i,ref:y,onKeyDown:ee(r,f=>{f.key==="Enter"&&f.preventDefault()}),onClick:ee(o,f=>{a(C=>P(C)?!0:!C),g&&h&&(m.current=f.isPropagationStopped(),m.current||f.stopPropagation())})})});ge.displayName=Ce;var ye=s.forwardRef((e,r)=>{const{__scopeCheckbox:o,name:i,checked:c,defaultChecked:n,required:d,disabled:l,value:u,onCheckedChange:x,form:v,...a}=e;return t.jsx(Qe,{__scopeCheckbox:o,checked:c,defaultChecked:n,disabled:l,required:d,onCheckedChange:x,name:i,form:v,value:u,internal_do_not_use_render:({isFormControl:m})=>t.jsxs(t.Fragment,{children:[t.jsx(ge,{...a,ref:r,__scopeCheckbox:o}),m&&t.jsx(ke,{__scopeCheckbox:o})]})})});ye.displayName=W;var Se="CheckboxIndicator",be=s.forwardRef((e,r)=>{const{__scopeCheckbox:o,forceMount:i,...c}=e,n=Y(Se,o);return t.jsx(Ee,{present:i||P(n.checked)||n.checked===!0,children:t.jsx(J.span,{"data-state":Ne(n.checked),"data-disabled":n.disabled?"":void 0,...c,ref:r,style:{pointerEvents:"none",...e.style}})})});be.displayName=Se;var je="CheckboxBubbleInput",ke=s.forwardRef(({__scopeCheckbox:e,...r},o)=>{const{control:i,hasConsumerStoppedPropagationRef:c,checked:n,defaultChecked:d,required:l,disabled:u,name:x,value:v,form:a,bubbleInput:m,setBubbleInput:h}=Y(je,e),g=te(o,h),y=He(n),k=Pe(i);s.useEffect(()=>{const C=m;if(!C)return;const N=window.HTMLInputElement.prototype,R=Object.getOwnPropertyDescriptor(N,"checked").set,D=!c.current;if(y!==n&&R){const T=new Event("click",{bubbles:D});C.indeterminate=P(n),R.call(C,P(n)?!1:n),C.dispatchEvent(T)}},[m,y,n,c]);const f=s.useRef(P(n)?!1:n);return t.jsx(J.input,{type:"checkbox","aria-hidden":!0,defaultChecked:d??f.current,required:l,disabled:u,name:x,value:v,form:a,...r,tabIndex:-1,ref:g,style:{...r.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ke.displayName=je;function We(e){return typeof e=="function"}function P(e){return e==="indeterminate"}function Ne(e){return P(e)?"indeterminate":e?"checked":"unchecked"}function Xe({className:e,...r}){return t.jsx(ye,{"data-slot":"checkbox",className:Te("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...r,children:t.jsx(be,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:t.jsx(_e,{className:"size-3.5"})})})}function mt(){const{serviceId:e}=Ae({strict:!1}),r=Ie(),o=se(),{data:i,isLoading:c}=Z({queryKey:["services",e],queryFn:()=>I.get(e)}),n=V({mutationFn:a=>I.update(e,a),onSuccess:()=>{o.invalidateQueries({queryKey:["services"]}),j.success("Service updated")},onError:a=>{j.error(F(a,"Failed to update service"))}}),d=V({mutationFn:()=>I.delete(e),onSuccess:()=>{o.invalidateQueries({queryKey:["services"]}),j.success("Service deleted"),r({to:"/services"})},onError:a=>{j.error(F(a,"Failed to delete service"))}}),l=V({mutationFn:a=>I.addMonitor(e,a),onSuccess:()=>{o.invalidateQueries({queryKey:["services",e]}),j.success("Monitor added")},onError:a=>{j.error(F(a,"Failed to add monitor"))}}),u=V({mutationFn:({monitorId:a,data:m})=>I.updateMonitor(e,a,m),onSuccess:()=>{o.invalidateQueries({queryKey:["services",e]}),j.success("Monitor updated")},onError:a=>{j.error(F(a,"Failed to update monitor"))}}),x=V({mutationFn:a=>I.deleteMonitor(e,a),onSuccess:()=>{o.invalidateQueries({queryKey:["services",e]}),j.success("Monitor removed")},onError:a=>{j.error(F(a,"Failed to remove monitor"))}});if(c||!i)return t.jsxs("div",{className:"max-w-2xl space-y-6",children:[t.jsx(H,{className:"h-8 w-40"}),t.jsx(H,{className:"h-52 w-full rounded-lg"}),t.jsx(H,{className:"h-40 w-full rounded-lg"})]});const v=a=>{n.mutate({name:a.name,description:a.description,severity:a.severity})};return t.jsxs("div",{className:"max-w-2xl",children:[t.jsx("h1",{className:"text-2xl font-bold text-foreground mb-6",children:"Edit Service"}),t.jsx(z,{className:"py-0",children:t.jsx(K,{className:"p-6",children:t.jsx(Ve,{initialData:{name:i.name,description:i.description??void 0,severity:i.severity},onSubmit:v,isLoading:n.isPending,submitLabel:"Update Service",showMonitors:!1})})}),t.jsx(Ze,{monitors:i.monitors,onAdd:a=>l.mutate(a),onUpdate:(a,m)=>u.mutate({monitorId:a,data:m}),onDelete:a=>x.mutate(a),isAdding:l.isPending}),t.jsx(Je,{serviceId:e}),t.jsxs(z,{className:"mt-6 border-red-200 dark:border-red-800 py-0",children:[t.jsx(ce,{children:t.jsx(ie,{className:"text-lg text-red-800 dark:text-red-200",children:"Danger Zone"})}),t.jsxs(K,{children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Deleting a service removes all monitors and alert history."}),t.jsxs(le,{children:[t.jsx(de,{asChild:!0,children:t.jsx(E,{variant:"destructive",children:"Delete Service"})}),t.jsxs(ue,{children:[t.jsxs(he,{children:[t.jsxs(xe,{children:['Delete service "',i.name,'"?']}),t.jsx(pe,{children:"This will permanently delete the service and all its monitors and alerts."})]}),t.jsxs(me,{children:[t.jsx(fe,{children:"Cancel"}),t.jsx(ve,{onClick:()=>d.mutate(),children:"Delete"})]})]})]})]})]})]})}function Ze({monitors:e,onAdd:r,onUpdate:o,onDelete:i,isAdding:c}){const[n,d]=s.useState(!1),[l,u]=s.useState(b.Heartbeat),[x,v]=s.useState(300),[a,m]=s.useState(60),[h,g]=s.useState(void 0),[y,k]=s.useState(void 0),[f,C]=s.useState(w.Immediate),[N,M]=s.useState(3),[R,D]=s.useState(7),[T,_]=s.useState(""),[q,U]=s.useState("GET"),[L,B]=s.useState("200"),[G,$]=s.useState(10),[O,Q]=s.useState(""),S=()=>{const p={type:l,intervalSeconds:x,gracePeriodSeconds:a};l===b.Metric&&(p.minValue=h,p.maxValue=y,p.thresholdStrategy=f,(f===w.ConsecutiveCount||f===w.SampleCountAverage)&&(p.thresholdCount=N),p.retentionDays=R),l===b.HealthCheck&&(p.healthCheckUrl=T,p.httpMethod=q,p.expectedStatusCodes=L,p.timeoutSeconds=G,p.bodyMatchRegex=O||void 0),r(p),d(!1),v(300),m(60),g(void 0),k(void 0),C(w.Immediate),M(3),D(7),_(""),U("GET"),B("200"),$(10),Q("")};return t.jsx(z,{className:"mt-6 py-0",children:t.jsxs(K,{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Monitors"}),t.jsx(E,{type:"button",variant:"link",size:"sm",className:"p-0 h-auto",onClick:()=>d(!n),children:n?"Cancel":"+ Add Monitor"})]}),n&&t.jsxs("div",{className:"border rounded p-4 mb-4 bg-muted space-y-3",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx(oe,{className:"text-xs text-muted-foreground",children:"Type"}),t.jsx(Fe,{value:l,onChange:u,triggerClassName:"w-full h-8 text-sm"})]}),t.jsx(ae,{intervalSeconds:x,gracePeriodSeconds:a,onIntervalChange:v,onGracePeriodChange:m}),l===b.Metric&&t.jsx(ne,{values:{minValue:h,maxValue:y,thresholdStrategy:f,thresholdCount:N,retentionDays:R},onChange:(p,A)=>{({minValue:g,maxValue:k,thresholdStrategy:C,thresholdCount:M,retentionDays:D})[p]?.(A)}}),l===b.HealthCheck&&t.jsx(re,{values:{healthCheckUrl:T,httpMethod:q,expectedStatusCodes:L,timeoutSeconds:G,bodyMatchRegex:O},onChange:(p,A)=>{({healthCheckUrl:_,httpMethod:U,expectedStatusCodes:B,timeoutSeconds:$,bodyMatchRegex:Q})[p]?.(A??"")},urlRequired:!0}),t.jsx(E,{type:"button",size:"sm",onClick:S,disabled:c,children:c?"Adding...":"Add"})]}),t.jsx("div",{className:"space-y-3",children:e.map(p=>t.jsx(Ye,{monitor:p,canDelete:e.length>1,onUpdate:A=>o(p.id,A),onDelete:()=>i(p.id)},p.id))})]})})}function Je({serviceId:e}){const r=se(),{data:o,isLoading:i}=Z({queryKey:["contacts"],queryFn:()=>X.list()}),{data:c,isLoading:n}=Z({queryKey:["services",e,"contacts"],queryFn:()=>X.getServiceContacts(e)}),[d,l]=s.useState(null),u=new Set(c?.map(h=>h.id)??[]),x=d??u,v=d!==null,a=V({mutationFn:h=>X.setServiceContacts(e,h),onSuccess:()=>{r.invalidateQueries({queryKey:["services",e,"contacts"]}),r.invalidateQueries({queryKey:["contacts"]}),l(null),j.success("Contacts updated")},onError:h=>{j.error(F(h,"Failed to update contacts"))}}),m=h=>{const g=d??u,y=new Set(g);y.has(h)?y.delete(h):y.add(h),l(y)};return i||n?t.jsxs(z,{className:"mt-6 py-0",children:[t.jsx(ce,{children:t.jsx(ie,{className:"text-lg",children:"Contacts"})}),t.jsx(K,{children:t.jsxs("div",{className:"space-y-3",children:[t.jsx(H,{className:"h-5 w-full rounded"}),t.jsx(H,{className:"h-5 w-full rounded"}),t.jsx(H,{className:"h-5 w-full rounded"})]})})]}):t.jsx(z,{className:"mt-6 py-0",children:t.jsxs(K,{className:"p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-foreground mb-2",children:"Contacts"}),t.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Select which contacts receive alerts for this service. If none are assigned, the default contact is used."}),!o||o.length===0?t.jsx("p",{className:"text-sm text-muted-foreground",children:"No contacts configured yet."}):t.jsx("div",{className:"space-y-2",children:o.map(h=>t.jsxs(oe,{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx(Xe,{checked:x.has(h.id),onCheckedChange:()=>m(h.id)}),t.jsx("span",{className:"text-sm text-foreground",children:h.name}),h.isDefault&&t.jsx("span",{className:"text-xs text-muted-foreground",children:"(default)"}),h.channels.length===0&&t.jsx("span",{className:"text-xs text-amber-600 dark:text-amber-400",children:"(no channels)"})]},h.id))}),v&&t.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[t.jsx(E,{size:"sm",onClick:()=>a.mutate(Array.from(x)),disabled:a.isPending,children:a.isPending?"Saving...":"Save Contacts"}),t.jsx(E,{variant:"secondary",size:"sm",onClick:()=>l(null),children:"Cancel"})]})]})})}function Ye({monitor:e,canDelete:r,onUpdate:o,onDelete:i}){const[c,n]=s.useState(!1),[d,l]=s.useState(e.intervalSeconds),[u,x]=s.useState(e.gracePeriodSeconds),[v,a]=s.useState(e.minValue??void 0),[m,h]=s.useState(e.maxValue??void 0),[g,y]=s.useState(e.thresholdStrategy??w.Immediate),[k,f]=s.useState(e.thresholdCount??3),[C,N]=s.useState(e.retentionDays??7),[M,R]=s.useState(e.healthCheckUrl??""),[D,T]=s.useState(e.httpMethod??"GET"),[_,q]=s.useState(e.expectedStatusCodes??"200"),[U,L]=s.useState(e.timeoutSeconds??10),[B,G]=s.useState(e.bodyMatchRegex??""),$={[b.Webhook]:"Webhook",[b.Heartbeat]:"Heartbeat",[b.HealthCheck]:"Health Check",[b.Metric]:"Metric"},O=()=>{const S={intervalSeconds:d,gracePeriodSeconds:u};e.type===b.Metric&&(S.minValue=v,S.maxValue=m,S.thresholdStrategy=g,(g===w.ConsecutiveCount||g===w.SampleCountAverage)&&(S.thresholdCount=k),S.retentionDays=C),e.type===b.HealthCheck&&(S.healthCheckUrl=M,S.httpMethod=D,S.expectedStatusCodes=_,S.timeoutSeconds=U,S.bodyMatchRegex=B||void 0),o(S),n(!1)},Q=()=>{l(e.intervalSeconds),x(e.gracePeriodSeconds),a(e.minValue??void 0),h(e.maxValue??void 0),y(e.thresholdStrategy??w.Immediate),f(e.thresholdCount??3),N(e.retentionDays??7),R(e.healthCheckUrl??""),T(e.httpMethod??"GET"),q(e.expectedStatusCodes??"200"),L(e.timeoutSeconds??10),G(e.bodyMatchRegex??""),n(!1)};return t.jsxs("div",{className:"border rounded p-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-foreground",children:$[e.type]}),t.jsxs("div",{className:"flex gap-2",children:[!c&&t.jsx(E,{type:"button",variant:"link",size:"xs",className:"p-0 h-auto",onClick:()=>n(!0),children:"Edit"}),t.jsxs(le,{children:[t.jsx(de,{asChild:!0,children:t.jsx(E,{type:"button",variant:"ghost",size:"xs",className:"p-0 h-auto text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 hover:bg-transparent",disabled:!r,children:"Remove"})}),t.jsxs(ue,{children:[t.jsxs(he,{children:[t.jsx(xe,{children:"Remove this monitor?"}),t.jsx(pe,{children:"This will permanently remove the monitor from this service."})]}),t.jsxs(me,{children:[t.jsx(fe,{children:"Cancel"}),t.jsx(ve,{onClick:()=>i(),children:"Remove"})]})]})]})]})]}),c?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ae,{intervalSeconds:d,gracePeriodSeconds:u,onIntervalChange:l,onGracePeriodChange:x}),e.type===b.Metric&&t.jsx(ne,{values:{minValue:v,maxValue:m,thresholdStrategy:g,thresholdCount:k,retentionDays:C},onChange:(S,p)=>{({minValue:a,maxValue:h,thresholdStrategy:y,thresholdCount:f,retentionDays:N})[S]?.(p)}}),e.type===b.HealthCheck&&t.jsx(re,{values:{healthCheckUrl:M,httpMethod:D,expectedStatusCodes:_,timeoutSeconds:U,bodyMatchRegex:B},onChange:(S,p)=>{({healthCheckUrl:R,httpMethod:T,expectedStatusCodes:q,timeoutSeconds:L,bodyMatchRegex:G})[S]?.(p??"")}}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(E,{type:"button",size:"xs",onClick:O,children:"Save"}),t.jsx(E,{type:"button",variant:"secondary",size:"xs",onClick:Q,children:"Cancel"})]})]}):t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Interval: ",e.intervalSeconds,"s | Grace: ",e.gracePeriodSeconds,"s",e.type===b.Metric&&t.jsxs("span",{children:[e.minValue!=null&&` | Min: ${e.minValue}`,e.maxValue!=null&&` | Max: ${e.maxValue}`,e.thresholdStrategy!=null&&` | ${w[e.thresholdStrategy]}`]}),e.type===b.HealthCheck&&t.jsxs("span",{children:[` | URL: ${e.healthCheckUrl}`,` | ${e.httpMethod??"GET"}`,` | ${e.expectedStatusCodes??"200"}`]})]})]})}export{mt as ServiceEdit};
