import{r as c,j as e,g as B,h as H,p as K,k as N,P as W,m as Q,n as b,q as U,u as A,B as g,I as Z,L as J,t as x}from"./index-fQZ-U2x6.js";import{u as X}from"./useQuery-BewFOG_L.js";import{u as C}from"./useMutation-BOTsmzZA.js";import{g as T}from"./types-wJsVDGZp.js";import{p as h}from"./services--_aFGxDX.js";import{S as Y}from"./StateIndicator-CC9lMCtR.js";import{I as ee}from"./input-BJMnUOvO.js";import{L as S}from"./label-B2sNe2d1.js";import{T as k}from"./textarea-Bhhfjl39.js";import{C as E,c as D}from"./card-BmoCGL6B.js";import{S as v}from"./skeleton-C53g7VWF.js";import{A as te,a as ae}from"./alert-C3YZIm6s.js";import{R as re,I as se,c as R}from"./index-B14eI_bF.js";import{u as ne}from"./index-DPAcrdZo.js";import{A as ie,a as oe,b as le,c as ce,d as de,e as ue,f as pe,g as me,h as fe}from"./alert-dialog-uLfenLJA.js";function ge(t){const a=xe(t),s=c.forwardRef((n,i)=>{const{children:l,...r}=n,d=c.Children.toArray(l),u=d.find(he);if(u){const p=u.props.children,o=d.map(m=>m===u?c.Children.count(p)>1?c.Children.only(null):c.isValidElement(p)?p.props.children:null:m);return e.jsx(a,{...r,ref:i,children:c.isValidElement(p)?c.cloneElement(p,void 0,o):null})}return e.jsx(a,{...r,ref:i,children:l})});return s.displayName=`${t}.Slot`,s}function xe(t){const a=c.forwardRef((s,n)=>{const{children:i,...l}=s;if(c.isValidElement(i)){const r=je(i),d=be(l,i.props);return i.type!==c.Fragment&&(d.ref=n?B(n,r):r),c.cloneElement(i,d)}return c.Children.count(i)>1?c.Children.only(null):null});return a.displayName=`${t}.SlotClone`,a}var ve=Symbol("radix.slottable");function he(t){return c.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===ve}function be(t,a){const s={...a};for(const n in a){const i=t[n],l=a[n];/^on[A-Z]/.test(n)?i&&l?s[n]=(...d)=>{const u=l(...d);return i(...d),u}:i&&(s[n]=i):n==="style"?s[n]={...i,...l}:n==="className"&&(s[n]=[i,l].filter(Boolean).join(" "))}return{...t,...s}}function je(t){let a=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=a&&"isReactWarning"in a&&a.isReactWarning;return s?t.ref:(a=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=a&&"isReactWarning"in a&&a.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var ye=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],j=ye.reduce((t,a)=>{const s=ge(`Primitive.${a}`),n=c.forwardRef((i,l)=>{const{asChild:r,...d}=i,u=r?s:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(u,{...d,ref:l})});return n.displayName=`Primitive.${a}`,{...t,[a]:n}},{}),y="Tabs",[Ne]=Q(y,[R]),_=R(),[Ce,w]=Ne(y),F=c.forwardRef((t,a)=>{const{__scopeTabs:s,value:n,onValueChange:i,defaultValue:l,orientation:r="horizontal",dir:d,activationMode:u="automatic",...p}=t,o=ne(d),[m,f]=H({prop:n,onChange:i,defaultProp:l??"",caller:y});return e.jsx(Ce,{scope:s,baseId:K(),value:m,onValueChange:f,orientation:r,dir:o,activationMode:u,children:e.jsx(j.div,{dir:o,"data-orientation":r,...p,ref:a})})});F.displayName=y;var V="TabsList",M=c.forwardRef((t,a)=>{const{__scopeTabs:s,loop:n=!0,...i}=t,l=w(V,s),r=_(s);return e.jsx(re,{asChild:!0,...r,orientation:l.orientation,dir:l.dir,loop:n,children:e.jsx(j.div,{role:"tablist","aria-orientation":l.orientation,...i,ref:a})})});M.displayName=V;var L="TabsTrigger",z=c.forwardRef((t,a)=>{const{__scopeTabs:s,value:n,disabled:i=!1,...l}=t,r=w(L,s),d=_(s),u=q(r.baseId,n),p=O(r.baseId,n),o=n===r.value;return e.jsx(se,{asChild:!0,...d,focusable:!i,active:o,children:e.jsx(j.button,{type:"button",role:"tab","aria-selected":o,"aria-controls":p,"data-state":o?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:u,...l,ref:a,onMouseDown:N(t.onMouseDown,m=>{!i&&m.button===0&&m.ctrlKey===!1?r.onValueChange(n):m.preventDefault()}),onKeyDown:N(t.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&r.onValueChange(n)}),onFocus:N(t.onFocus,()=>{const m=r.activationMode!=="manual";!o&&!i&&m&&r.onValueChange(n)})})})});z.displayName=L;var $="TabsContent",G=c.forwardRef((t,a)=>{const{__scopeTabs:s,value:n,forceMount:i,children:l,...r}=t,d=w($,s),u=q(d.baseId,n),p=O(d.baseId,n),o=n===d.value,m=c.useRef(o);return c.useEffect(()=>{const f=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(f)},[]),e.jsx(W,{present:i||o,children:({present:f})=>e.jsx(j.div,{"data-state":o?"active":"inactive","data-orientation":d.orientation,role:"tabpanel","aria-labelledby":u,hidden:!f,id:p,tabIndex:0,...r,ref:a,style:{...t.style,animationDuration:m.current?"0s":void 0},children:f&&l})})});G.displayName=$;function q(t,a){return`${t}-trigger-${a}`}function O(t,a){return`${t}-content-${a}`}var Te=F,we=M,Se=z,ke=G;function Pe({className:t,orientation:a="horizontal",...s}){return e.jsx(Te,{"data-slot":"tabs","data-orientation":a,orientation:a,className:b("group/tabs flex gap-2 data-[orientation=horizontal]:flex-col",t),...s})}const Ie=U("rounded-lg p-[3px] group-data-[orientation=horizontal]/tabs:h-9 data-[variant=line]:rounded-none group/tabs-list text-muted-foreground inline-flex w-fit items-center justify-center group-data-[orientation=vertical]/tabs:h-fit group-data-[orientation=vertical]/tabs:flex-col",{variants:{variant:{default:"bg-muted",line:"gap-1 bg-transparent"}},defaultVariants:{variant:"default"}});function Ae({className:t,variant:a="default",...s}){return e.jsx(we,{"data-slot":"tabs-list","data-variant":a,className:b(Ie({variant:a}),t),...s})}function P({className:t,...a}){return e.jsx(Se,{"data-slot":"tabs-trigger",className:b("focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring text-foreground/60 hover:text-foreground dark:text-muted-foreground dark:hover:text-foreground relative inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all group-data-[orientation=vertical]/tabs:w-full group-data-[orientation=vertical]/tabs:justify-start focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 group-data-[variant=default]/tabs-list:data-[state=active]:shadow-sm group-data-[variant=line]/tabs-list:data-[state=active]:shadow-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4","group-data-[variant=line]/tabs-list:bg-transparent group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:border-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent","data-[state=active]:bg-background dark:data-[state=active]:text-foreground dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 data-[state=active]:text-foreground","after:bg-foreground after:absolute after:opacity-0 after:transition-opacity group-data-[orientation=horizontal]/tabs:after:inset-x-0 group-data-[orientation=horizontal]/tabs:after:bottom-[-5px] group-data-[orientation=horizontal]/tabs:after:h-0.5 group-data-[orientation=vertical]/tabs:after:inset-y-0 group-data-[orientation=vertical]/tabs:after:-right-1 group-data-[orientation=vertical]/tabs:after:w-0.5 group-data-[variant=line]/tabs-list:data-[state=active]:after:opacity-100",t),...a})}function I({className:t,...a}){return e.jsx(ke,{"data-slot":"tabs-content",className:b("flex-1 outline-none",t),...a})}function We(){const t=A(),[a,s]=c.useState(!1),{data:n,isLoading:i}=X({queryKey:["peers"],queryFn:()=>h.list()}),l=C({mutationFn:r=>h.unpair(r),onSuccess:()=>{t.invalidateQueries({queryKey:["peers"]}),x.success("Peer unpaired")},onError:r=>{x.error(T(r,"Failed to unpair peer"))}});return i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{className:"h-8 w-24"}),e.jsx(v,{className:"h-9 w-32 rounded-md"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{className:"h-28 w-full rounded-lg"}),e.jsx(v,{className:"h-28 w-full rounded-lg"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Peers"}),e.jsx(g,{onClick:()=>s(!0),children:"Pair Instance"})]}),a&&e.jsx(Ee,{onClose:()=>s(!1)}),n?.length===0?e.jsxs(te,{children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx(ae,{children:'No paired instances. Click "Pair Instance" to connect with another mkat instance.'})]}):e.jsx("div",{className:"space-y-4",children:n?.map(r=>e.jsx(E,{className:"py-0",children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:r.name}),r.serviceState!=null&&e.jsx(Y,{state:r.serviceState,size:"sm"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r.url}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Paired ",new Date(r.pairedAt).toLocaleString()," | Heartbeat every ",r.heartbeatIntervalSeconds,"s"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{to:"/services/$serviceId",params:{serviceId:r.serviceId},className:"px-3 py-1.5 text-sm bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded hover:bg-blue-200 dark:hover:bg-blue-800",children:"View Service"}),e.jsxs(ie,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(g,{variant:"destructive",size:"sm",children:"Unpair"})}),e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsxs(de,{children:["Unpair from ",r.name,"?"]}),e.jsx(ue,{children:"This will disconnect the peer and stop monitoring its heartbeat."})]}),e.jsxs(pe,{children:[e.jsx(me,{children:"Cancel"}),e.jsx(fe,{onClick:()=>l.mutate(r.id),children:"Unpair"})]})]})]})]})]})})},r.id))})]})}function Ee({onClose:t}){const a=A(),[s,n]=c.useState(""),[i,l]=c.useState(""),[r,d]=c.useState(""),u=C({mutationFn:o=>h.initiate(o),onSuccess:o=>{l(o.token)},onError:o=>{x.error(T(o,"Failed to generate pairing token"))}}),p=C({mutationFn:o=>h.complete(o),onSuccess:()=>{a.invalidateQueries({queryKey:["peers"]}),x.success("Pairing complete"),t()},onError:o=>{x.error(T(o,"Failed to complete pairing"))}});return e.jsx(E,{className:"border-blue-200 dark:border-blue-800 py-0",children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Pair with Another Instance"}),e.jsx(g,{variant:"ghost",size:"sm",onClick:t,children:"Close"})]}),e.jsxs(Pe,{defaultValue:"generate",className:"w-full",children:[e.jsxs(Ae,{className:"grid w-full grid-cols-2",children:[e.jsx(P,{value:"generate",children:"Generate Token"}),e.jsx(P,{value:"enter",children:"Enter Token"})]}),e.jsx(I,{value:"generate",className:"space-y-3",children:i?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Share this token with the other instance. It expires in 10 minutes."}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{readOnly:!0,value:i,className:"text-xs font-mono",rows:3}),e.jsx(g,{variant:"secondary",size:"xs",className:"absolute top-2 right-2",onClick:()=>navigator.clipboard.writeText(i),children:"Copy"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Instance Name"}),e.jsx(ee,{type:"text",value:s,onChange:o=>n(o.target.value),placeholder:"e.g. Home Server"})]}),e.jsx(g,{onClick:()=>u.mutate(s),disabled:!s||u.isPending,children:u.isPending?"Generating...":"Generate Token"})]})}),e.jsxs(I,{value:"enter",className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Pairing Token"}),e.jsx(k,{value:r,onChange:o=>d(o.target.value),placeholder:"Paste the token from the other instance",className:"text-xs font-mono",rows:3})]}),e.jsx(g,{onClick:()=>p.mutate(r.trim()),disabled:!r.trim()||p.isPending,children:p.isPending?"Pairing...":"Complete Pairing"})]})]})]})})}export{We as Peers};
