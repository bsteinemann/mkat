# Implementation Plan: M1.1 Dev Containers

**Milestone:** 1.1 - Development Environment
**Goal:** Reproducible development environment with all tools pre-configured

---

## Summary

Set up a VS Code Dev Container that includes all tools needed to develop, test, and run mkat â€” .NET SDK, Node.js, EF Core tools, Claude CLI, Docker-in-Docker, and relevant VS Code extensions.

---

## 1. Dev Container Configuration

### 1.1 Create `.devcontainer/devcontainer.json`

```jsonc
{
  "name": "mkat",
  "build": {
    "dockerfile": "Dockerfile",
    "context": ".."
  },
  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {},
    "ghcr.io/devcontainers/features/node:1": {
      "version": "20"
    },
    "ghcr.io/devcontainers/features/dotnet:2": {
      "version": "8.0"
    },
    "ghcr.io/devcontainers/features/git:1": {}
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-dotnettools.csdevkit",
        "ms-dotnettools.csharp",
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode",
        "bradlc.vscode-tailwindcss",
        "ms-azuretools.vscode-docker",
        "formulahendry.dotnet-test-explorer",
        "eamodio.gitlens",
        "humao.rest-client"
      ],
      "settings": {
        "dotnet.defaultSolution": "Mkat.sln",
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        "[csharp]": {
          "editor.defaultFormatter": "ms-dotnettools.csharp"
        }
      }
    }
  },
  "postCreateCommand": ".devcontainer/post-create.sh",
  "forwardPorts": [5000, 5173, 8080],
  "portsAttributes": {
    "5000": { "label": "API (dev)" },
    "5173": { "label": "Vite (frontend)" },
    "8080": { "label": "Docker (prod)" }
  },
  "remoteUser": "vscode"
}
```

### 1.2 Create `.devcontainer/Dockerfile`

```dockerfile
FROM mcr.microsoft.com/devcontainers/base:ubuntu

# SQLite tools for inspecting the database
RUN apt-get update && apt-get install -y \
    sqlite3 \
    && rm -rf /var/lib/apt/lists/*
```

### 1.3 Create `.devcontainer/post-create.sh`

```bash
#!/bin/bash
set -e

# Install .NET EF Core tools
dotnet tool install --global dotnet-ef

# Install Claude CLI
npm install -g @anthropic-ai/claude-code

# Restore .NET packages (if solution exists)
if [ -f "Mkat.sln" ]; then
  dotnet restore
fi

# Install frontend dependencies (if package.json exists)
if [ -f "src/mkat-ui/package.json" ]; then
  cd src/mkat-ui && npm install
fi

echo "Dev container setup complete."
```

---

## 2. Files to Create

| File | Purpose |
|------|---------|
| `.devcontainer/devcontainer.json` | Dev container configuration |
| `.devcontainer/Dockerfile` | Base image with system packages |
| `.devcontainer/post-create.sh` | Post-creation setup script |

---

## 3. Tools Included

| Tool | Version | Purpose |
|------|---------|---------|
| .NET SDK | 8.0 | Backend development |
| dotnet-ef | latest | EF Core migrations |
| Node.js | 20.x | Frontend tooling (Vite, npm) |
| Docker-in-Docker | latest | Build/run containers from inside container |
| Git | latest | Version control |
| SQLite3 | latest | Database inspection |
| Claude CLI | latest | AI-assisted development |

---

## 4. VS Code Extensions

| Extension | Purpose |
|-----------|---------|
| C# Dev Kit | .NET development, debugging, testing |
| C# | Language support, IntelliSense |
| ESLint | JavaScript/TypeScript linting |
| Prettier | Code formatting |
| Tailwind CSS IntelliSense | Tailwind class autocomplete |
| Docker | Dockerfile/compose support |
| .NET Test Explorer | Run tests from sidebar |
| GitLens | Git history and blame |
| REST Client | Test API endpoints |

---

## 5. Port Forwarding

| Port | Service |
|------|---------|
| 5000 | ASP.NET Core API (development) |
| 5173 | Vite dev server (frontend) |
| 8080 | Docker container (production build) |

---

## 6. Verification Checklist

- [ ] `dotnet --version` returns 8.x
- [ ] `node --version` returns 20.x
- [ ] `dotnet ef --version` works
- [ ] `claude --version` works
- [ ] `docker --version` works
- [ ] `sqlite3 --version` works
- [ ] VS Code extensions auto-install
- [ ] Port forwarding works for all 3 ports
- [ ] `dotnet restore` succeeds (after M1 is implemented)
- [ ] `npm install` succeeds in mkat-ui (after M5 is implemented)

---

**Status:** Ready for implementation
**Dependencies:** None (can be implemented before or after M1)
**Estimated complexity:** Low
