# shadcn/ui Incremental Migration Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Migrate the mkat-ui frontend from hand-built Tailwind components to shadcn/ui, incrementally, keeping the app functional at every step.

**Architecture:** shadcn/ui copies component source into `src/components/ui/`. Existing components in `src/components/` and `src/pages/` are updated one at a time to import from `@/components/ui/*` instead of using raw Tailwind classes. Each task is a self-contained migration of one component type — the app builds and works after every task.

**Tech Stack:** React 19, Tailwind CSS v4, Vite 7, shadcn/ui (latest), TanStack Router/Query

---

## Prerequisites

- Read `docs/learnings.md` — relevant entries: M5 Frontend (Tailwind v4 setup, Vite 7 plugin)
- The app currently has no `@` path alias — shadcn/ui requires it
- No component library is installed — this is a greenfield setup

---

## Task 1: Configure shadcn/ui Foundation

Set up the tooling and path aliases so `npx shadcn@latest add <component>` works.

**Files:**
- Modify: `src/mkat-ui/tsconfig.json`
- Modify: `src/mkat-ui/tsconfig.app.json`
- Modify: `src/mkat-ui/vite.config.ts`
- Modify: `src/mkat-ui/package.json` (via npm install)
- Create: `src/mkat-ui/components.json` (auto-generated by `shadcn init`)
- Modify: `src/mkat-ui/src/index.css` (shadcn base styles)
- Create: `src/mkat-ui/src/lib/utils.ts` (cn utility, auto-generated)

**Steps:**

1. Add `@` path alias to `tsconfig.json` and `tsconfig.app.json`:
   ```json
   // tsconfig.json — add to compilerOptions
   {
     "baseUrl": ".",
     "paths": {
       "@/*": ["./src/*"]
     }
   }
   ```
   ```json
   // tsconfig.app.json — add to compilerOptions
   {
     "baseUrl": ".",
     "paths": {
       "@/*": ["./src/*"]
     }
   }
   ```

2. Add Vite path alias in `vite.config.ts`:
   ```ts
   import path from "path"
   // ... existing imports
   export default defineConfig({
     // ... existing config
     resolve: {
       alias: {
         "@": path.resolve(__dirname, "./src"),
       },
     },
   })
   ```

3. Install `@types/node` if not already present:
   ```bash
   cd src/mkat-ui && npm install -D @types/node
   ```

4. Run shadcn init:
   ```bash
   cd src/mkat-ui && npx shadcn@latest init
   ```
   - Select: New York style (compact, fits a dashboard/monitoring UI)
   - Select: Zinc base color (neutral, works well with status colors)
   - Accept CSS variables: Yes

5. Verify: `cd src/mkat-ui && npm run build` — should succeed with no errors.

6. Commit: `chore: configure shadcn/ui foundation with path aliases`

---

## Task 2: Migrate Buttons

Buttons are the most frequently used element. Migrate all `<button>` elements to the shadcn `Button` component.

**Files:**
- Create: `src/mkat-ui/src/components/ui/button.tsx` (via `npx shadcn@latest add button`)
- Modify: `src/mkat-ui/src/components/common/Pagination.tsx`
- Modify: `src/mkat-ui/src/pages/Login.tsx`
- Modify: `src/mkat-ui/src/pages/Contacts.tsx`
- Modify: `src/mkat-ui/src/pages/Dashboard.tsx`
- Modify: `src/mkat-ui/src/components/services/ServiceCard.tsx`
- Modify: `src/mkat-ui/src/components/services/ServiceForm.tsx`
- Modify: `src/mkat-ui/src/components/alerts/AlertItem.tsx`
- Modify: `src/mkat-ui/src/pages/Services.tsx`
- Modify: `src/mkat-ui/src/pages/ServiceDetail.tsx`
- Modify: `src/mkat-ui/src/pages/ServiceEdit.tsx`
- Modify: `src/mkat-ui/src/pages/Peers.tsx`

**Steps:**

1. Add the button component:
   ```bash
   cd src/mkat-ui && npx shadcn@latest add button
   ```

2. Map existing button patterns to shadcn variants:
   | Current Pattern | shadcn Variant |
   |---|---|
   | `bg-blue-600 text-white rounded hover:bg-blue-700` | `<Button>` (default) |
   | `bg-gray-100 text-gray-800 rounded hover:bg-gray-200` | `<Button variant="secondary">` |
   | `bg-red-100 text-red-800 rounded hover:bg-red-200` | `<Button variant="destructive">` |
   | `text-blue-600 hover:text-blue-800` | `<Button variant="link">` |
   | `text-sm text-gray-600 hover:text-gray-800` | `<Button variant="ghost">` |
   | `border rounded hover:bg-gray-50` | `<Button variant="outline">` |
   | Small buttons (`text-xs px-2 py-1`) | Add `size="sm"` |

3. Migrate each file one at a time. For each file:
   - Replace `<button className="...">` with `<Button variant="..." size="...">`.
   - Preserve all `onClick`, `disabled`, `type` props.
   - Remove raw Tailwind button classes.
   - Keep any non-button Tailwind layout classes (e.g., `w-full`).

4. Verify: `cd src/mkat-ui && npm run build` — should succeed.

5. Visually spot-check: `cd src/mkat-ui && npm run dev` — buttons should look consistent.

6. Commit: `refactor: migrate buttons to shadcn/ui Button component`

---

## Task 3: Migrate Form Inputs (Input, Label, Textarea, Select)

Forms appear in Login, ServiceForm, Contacts, and ServiceEdit. Migrate all form elements.

**Files:**
- Create (via shadcn add): `input.tsx`, `label.tsx`, `textarea.tsx`, `select.tsx`
- Modify: `src/mkat-ui/src/pages/Login.tsx`
- Modify: `src/mkat-ui/src/components/services/ServiceForm.tsx`
- Modify: `src/mkat-ui/src/pages/Contacts.tsx` (ContactForm, AddChannelForm, ContactDetail)
- Modify: `src/mkat-ui/src/pages/Peers.tsx`

**Steps:**

1. Add form components:
   ```bash
   cd src/mkat-ui && npx shadcn@latest add input label textarea select
   ```

2. Map existing patterns:
   | Current Pattern | shadcn Component |
   |---|---|
   | `<label className="block text-sm font-medium text-gray-700">` | `<Label>` |
   | `<input className="mt-1 block w-full rounded border-gray-300 shadow-sm ...">` | `<Input>` |
   | `<textarea className="mt-1 block w-full rounded ...">` | `<Textarea>` |
   | `<select className="mt-1 block w-full rounded ...">` | `<Select>` + `<SelectTrigger>` + `<SelectContent>` + `<SelectItem>` |

3. Note: shadcn's Select is Radix-based (not native `<select>`). This changes the API:
   - Replace `<select value={x} onChange={e => set(e.target.value)}>` with:
     ```tsx
     <Select value={x} onValueChange={set}>
       <SelectTrigger><SelectValue /></SelectTrigger>
       <SelectContent>
         <SelectItem value="...">Label</SelectItem>
       </SelectContent>
     </Select>
     ```
   - Values must be strings (not numbers). For enum-based selects (Severity, MonitorType, ChannelType), convert: `value={String(enumVal)}` / `onValueChange={v => set(Number(v))}`.

4. Migrate each file. Keep form structure and state logic identical.

5. Verify: `cd src/mkat-ui && npm run build` — should succeed.

6. Commit: `refactor: migrate form elements to shadcn/ui Input, Label, Textarea, Select`

---

## Task 4: Migrate Cards

Cards are used everywhere: ServiceCard, Dashboard stat cards, Contacts, Peers. Migrate to shadcn Card.

**Files:**
- Create (via shadcn add): `card.tsx`
- Modify: `src/mkat-ui/src/components/services/ServiceCard.tsx`
- Modify: `src/mkat-ui/src/pages/Dashboard.tsx` (StatCard, recent alerts card, down services card)
- Modify: `src/mkat-ui/src/pages/Contacts.tsx` (contact cards, ContactForm, ContactDetail)
- Modify: `src/mkat-ui/src/pages/Peers.tsx`
- Modify: `src/mkat-ui/src/pages/ServiceDetail.tsx`
- Modify: `src/mkat-ui/src/pages/ServiceEdit.tsx`

**Steps:**

1. Add the card component:
   ```bash
   cd src/mkat-ui && npx shadcn@latest add card
   ```

2. Map existing patterns:
   | Current Pattern | shadcn Component |
   |---|---|
   | `<div className="bg-white rounded-lg shadow p-4">` | `<Card><CardContent>` |
   | With title: `<h2> + content` | `<Card><CardHeader><CardTitle> + <CardContent>` |
   | With border accent: `border-l-4 border-green-200` | `<Card className="border-l-4 border-green-200">` |

3. ServiceCard retains its severity-colored left border via className override.

4. Verify: `cd src/mkat-ui && npm run build`

5. Commit: `refactor: migrate cards to shadcn/ui Card component`

---

## Task 5: Migrate Badges

Badges appear on severity indicators, alert types, contact default markers, and channel status.

**Files:**
- Create (via shadcn add): `badge.tsx`
- Modify: `src/mkat-ui/src/components/alerts/AlertItem.tsx`
- Modify: `src/mkat-ui/src/pages/Contacts.tsx` (Default badge, Enabled/Disabled badges)
- Modify: `src/mkat-ui/src/pages/ServiceDetail.tsx` (monitor type badges)

**Steps:**

1. Add the badge component:
   ```bash
   cd src/mkat-ui && npx shadcn@latest add badge
   ```

2. Map existing patterns:
   | Current Pattern | shadcn Component |
   |---|---|
   | `<span className="px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded">` | `<Badge variant="secondary">` or `<Badge className="bg-blue-100 text-blue-800">` |
   | Severity badges (green/yellow/orange/red bg + text) | `<Badge className={severityBadge[severity]}>` |
   | Alert type labels | `<Badge variant="outline" className={typeColors[type]}>` |

3. Keep custom color mappings (severityBadge, typeColors) — just wrap in `<Badge>` instead of raw `<span>`.

4. Verify: `cd src/mkat-ui && npm run build`

5. Commit: `refactor: migrate badges to shadcn/ui Badge component`

---

## Task 6: Add Alert Dialog (replace native confirm())

The app uses `confirm()` for destructive actions (delete service, delete contact, remove channel). Replace with shadcn AlertDialog.

**Files:**
- Create (via shadcn add): `alert-dialog.tsx`
- Modify: `src/mkat-ui/src/pages/Contacts.tsx` (delete contact, remove channel)
- Modify: `src/mkat-ui/src/pages/ServiceEdit.tsx` (delete service)

**Steps:**

1. Add alert-dialog:
   ```bash
   cd src/mkat-ui && npx shadcn@latest add alert-dialog
   ```

2. Replace each `confirm()` call with:
   ```tsx
   <AlertDialog>
     <AlertDialogTrigger asChild>
       <Button variant="destructive" size="sm">Delete</Button>
     </AlertDialogTrigger>
     <AlertDialogContent>
       <AlertDialogHeader>
         <AlertDialogTitle>Are you sure?</AlertDialogTitle>
         <AlertDialogDescription>This action cannot be undone.</AlertDialogDescription>
       </AlertDialogHeader>
       <AlertDialogFooter>
         <AlertDialogCancel>Cancel</AlertDialogCancel>
         <AlertDialogAction onClick={handleDelete}>Delete</AlertDialogAction>
       </AlertDialogFooter>
     </AlertDialogContent>
   </AlertDialog>
   ```

3. This changes the button from `onClick → confirm() → mutate()` to declarative dialog trigger. The mutation call moves into `AlertDialogAction`'s `onClick`.

4. Verify: `cd src/mkat-ui && npm run build`

5. Commit: `refactor: replace native confirm() with shadcn/ui AlertDialog`

---

## Task 7: Migrate Layout (Sidebar Navigation)

Migrate the sidebar and header to use shadcn's sidebar component for a more polished nav experience.

**Files:**
- Create (via shadcn add): `sidebar.tsx` and related sub-components
- Modify: `src/mkat-ui/src/components/layout/Sidebar.tsx`
- Modify: `src/mkat-ui/src/components/layout/Header.tsx`
- Modify: `src/mkat-ui/src/components/layout/Layout.tsx`

**Steps:**

1. Add sidebar component:
   ```bash
   cd src/mkat-ui && npx shadcn@latest add sidebar
   ```

2. Restructure Layout to use `<SidebarProvider>` + `<Sidebar>` + `<SidebarContent>`.

3. Move nav links into `<SidebarMenu>` / `<SidebarMenuItem>` / `<SidebarMenuButton>`.

4. Keep the header as-is or wrap in shadcn's layout pattern.

5. Verify: `cd src/mkat-ui && npm run build`

6. Commit: `refactor: migrate sidebar navigation to shadcn/ui Sidebar`

---

## Task 8: Add Toast Notifications (replace inline error messages)

Replace inline error/success messages with shadcn toast (Sonner).

**Files:**
- Create (via shadcn add): `sonner.tsx`
- Modify: `src/mkat-ui/src/pages/Login.tsx` (replace error div)
- Modify: `src/mkat-ui/src/pages/Contacts.tsx` (mutation success/error feedback)
- Modify: `src/mkat-ui/src/pages/ServiceEdit.tsx` (mutation feedback)
- Modify: `src/mkat-ui/src/pages/ServiceCreate.tsx` (mutation feedback)
- Modify: `src/mkat-ui/src/components/layout/Layout.tsx` (add `<Toaster />`)

**Steps:**

1. Add sonner:
   ```bash
   cd src/mkat-ui && npx shadcn@latest add sonner
   ```

2. Add `<Toaster />` to the root Layout component.

3. Replace inline error divs with `toast.error("message")` calls in mutation `onError` callbacks.

4. Add `toast.success("message")` to mutation `onSuccess` callbacks where appropriate.

5. Keep Login page's inline error as-is (form-level error is better UX for login).

6. Verify: `cd src/mkat-ui && npm run build`

7. Commit: `refactor: add shadcn/ui Sonner toast for mutation feedback`

---

## Task 9: Final Cleanup

Remove any leftover raw Tailwind patterns that now have shadcn equivalents. Ensure consistency.

**Files:**
- All previously modified files — audit for remaining raw `<button>`, `<input>`, `<select>` elements
- `src/mkat-ui/src/index.css` — remove any unused custom CSS
- Remove `@heroicons/react` if all icons have been replaced (evaluate; likely keep it — shadcn uses Lucide but heroicons may still be useful)

**Steps:**

1. Search for raw `<button` elements not using `<Button>`:
   ```bash
   grep -r '<button' src/mkat-ui/src/ --include='*.tsx'
   ```
   Migrate any remaining instances.

2. Search for raw `<input` elements not using `<Input>`:
   ```bash
   grep -r '<input' src/mkat-ui/src/ --include='*.tsx'
   ```

3. Evaluate icon situation: shadcn/ui uses Lucide icons. Either:
   - Keep `@heroicons/react` alongside Lucide (pragmatic, avoids churn)
   - Migrate to Lucide icons (consistent, removes a dependency)

   Recommend: keep both for now, use Lucide for new code.

4. Verify full build: `cd src/mkat-ui && npm run build`

5. Visually test all pages: Dashboard, Services, ServiceDetail, ServiceCreate, ServiceEdit, Alerts, Contacts, Peers, Login.

6. Commit: `refactor: final cleanup of shadcn/ui migration`

---

## Migration Order Summary

| Task | Component | Risk | Files Touched |
|------|-----------|------|---------------|
| 1 | Foundation (tooling) | Low | 4 config files |
| 2 | Button | Low | 12 files |
| 3 | Input, Label, Textarea, Select | Medium | 5 files (Select API change) |
| 4 | Card | Low | 7 files |
| 5 | Badge | Low | 3 files |
| 6 | AlertDialog | Low | 3 files |
| 7 | Sidebar | Medium | 3 files (layout restructure) |
| 8 | Toast (Sonner) | Low | 5 files |
| 9 | Cleanup | Low | audit all |

**Total: 9 tasks, app stays functional after each one.**

## Notes

- **StateIndicator** (`src/components/services/StateIndicator.tsx`) is a custom animated status dot — no shadcn equivalent. Keep as-is.
- **Pagination** could optionally be replaced with shadcn's Pagination component, but the current one is simple and works. Migrate during Task 2 (buttons) and optionally revisit.
- **CopyableUrl** is custom clipboard logic — keep as-is, just update its button to use `<Button>`.
- **MonitorDescription** is a text display component — no migration needed.
